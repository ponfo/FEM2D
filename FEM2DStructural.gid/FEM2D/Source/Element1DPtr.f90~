module Element1DPtrMOD
  use tools
  
  use PointMOD
  use PointPtrMOD
  
  use MaterialPtrMOD
  
  use GeometryPtrMOD
  
  use FEMIntegratorPtrMOD
  
  use ElementMOD
  use Element1DMOD
  implicit none
  private
  public :: Element1DPtrTYPE
  type :: Element1DPtrTYPE
     class(Element1DTYPE), pointer :: ptr
   contains
     procedure :: getnPoint
     procedure :: getnDof
     procedure :: getOnePoint
     procedure :: getAllPoints
     procedure :: getPointID
     procedure :: getMaterial
     procedure :: getGeometry
     procedure :: getIntegrator
     procedure :: getLenght
     procedure :: setnPoint
     procedure :: setnDof
     procedure :: setPoint
     procedure :: setIntegrator
     procedure :: setLenght
     procedure :: jacobian
     procedure :: shapeFunc
     procedure :: dShapeFunc
     procedure :: getStiffness
  end type Element1DPtrTYPE

contains

  integer(ikind) function getnPoint(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    getnPoint = this%ptr%nPoint
  end function getnPoint

  integer(ikind) function getnDof(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    getnDof = this%ptr%nDof
  end function getnDof
  
  type(PointPtrTYPE) function getOnePoint(this, i)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    integer(ikind), intent(in) :: i
    getOnePoint = this%ptr%point(i)
  end function getOnePoint
  
  function getAllPoints(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    type(PointPtrTYPE), dimension(this%nPoint) :: getAllPoints
    getAllPoints(1:this%nPoint) = this%ptr%point(1:this%nPoint)
  end function getAllPoints
  
  integer(ikind) function getPointID(this, i)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    integer(ikind), intent(in) :: i
    getPointID = this%ptr%point(i)%getID()
  end function getPointID
  
  function getMaterial(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    type(MaterialPtrTYPE) :: getMaterial
    getMaterial = this%ptr%material%ptr
  end function getMaterial

  function getGeometry(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    type(GeometryPtrTYPE) :: getGeometry
    getGeometry = this%ptr%geometry%ptr
  end function getGeometry

  function getIntegrator(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    type(FEMIntegratorPtrTYPE) :: getIntegrator
    getIntegrator = this%ptr%integrator%ptr
  end function getIntegrator

  subroutine setnPoint(this, nPoint)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    integer(ikind), intent(in) :: nPoint
    this%ptr%nPoint = nPoint
  end subroutine setnPoint

  subroutine setnDof(this, nDof)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    integer(ikind), intent(in) :: nDof
    this%ptr%nDof = nDof
  end subroutine setnDof

  subroutine setPoint(this, i, point)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    integer(ikind), intent(in) :: i
    class(PointTYPE), target, intent(in) :: point
    this%point(i)%ptr => point
  end subroutine setPoint

  subroutine setIntegrator(this, integrator)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    type(IntegratorTYPE), target, intent(in) :: integrator
    this%ptr%integrator%ptr => integrator
  end subroutine setIntegrator

  subroutine setLenght(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    call this%ptr%setLenght()
  end subroutine setLenght

  real(rkind) function getLenght(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    getLenght = this%ptr%lenght
  end function getLenght

  real(rkind) function jacobian(this, u)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    real(rkind), intent(in) :: u
    jacobian = this%ptr%jacobian(u)
  end function jacobian

  function shapeFunc(this, x)
    implicit none
    clasS(Element1DPtrTYPE), intent(inout) :: this
    real(rkind), intent(in) :: u
    real(rkind), dimension(this%nPoint*this%nDof) :: shapefunc
    shapeFunc = this%ptr%shapeFunc(u)
  end function shapeFunc

  function dShapeFunc(this, u)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    real(rkind), intent(in) :: u
    real(rkind), dimension(2, this%nPoint*this%nDof) :: dShapeFunc
    dShapeFunc = this%ptr%dShapeFunc(u)
  end function dShapeFunc

  function getStiffness(this)
    implicit none
    class(Element1DPtrTYPE), intent(inout) :: this
    real(rkind), dimension(this%nPoint*this%nDof,this%nPoint*this%nDof) :: getStiffness
    getStiffness = this%ptr%getStiffness()
  end function getStiffness

end module Element1DPtrMOD
